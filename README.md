# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

*Изменения в верстке* 
- `<template id="basket">` убран аттрибут disabled у `.basket__button`
- `<template id="card-catalog">` - убран дефолтный класс цвета категории, дефолт установлен в utils для рендера товаров

## Данные и типы данных, используемые в приложении

IProduct (Интерфейс):
   
```ts
type IProduct = {
  id: number;        // Уникальный идентификатор товара
  description: string;      // Описание товара
  image: string;     // URL изображения товара
  title: string;     // Название товара
  category: string;  // Категория товара
  price: number;     // Цена товара
}
```

UserData (данные вводимые пользователем):

```ts
type UserData = {
  phone: string;
	email: string;
	address: string;
	payment: PaymentType;
}
```

enum для поля payment
```ts
enum PaymentType {
	card = 'card',
	cash = 'cash',
}
```
<!-- 
Данные отображаемые в списке товаров

```ts
type TProductList = Pick<IProduct, 'category' | 'title' | 'image' | 'price' >;
```
Данные отображаемые в форме в корзине
```ts
type TProductСart = Pick<IProduct, 'price' | 'title'>
```
#### ФОРМА ЗАКАЗА

Первый шаг оформления форма name="order"
```ts
type TUserOrder = Pick<IOrder, 'payment' | 'address'>
```
Второй шаг оформления форма name="contacts"
```ts
type TUserСontacts = Pick<IOrder, 'email' | 'phone'>
``` -->


## Архтектура приложения

Архитектура проекта основана на паттерне MVP (Model-View-Presenter):
- модель - реализована классами `OrderModel` и `ProductModel`. Управляет данными приложения, включая товары и корзину;
- отображение - отображает данные пользователю и обрабатывает пользовательский ввод;
- презентер - отвечает за связь представления и данных, обрабатывает события с помощью `eventEmiter`. Используется несколько презентеров, каждый из которых отвечает за определенную сущность ( например `ModalView <-> ModalPresenter`)

## Базовый код ( не относится к слоям)

### ProductsService

Служебный класс адаптер для получения данных о товарах. В конструктор принимает объект `api` с реализацией интерфейса `Api`.\

Методы:
- `getAllProducts(): Promise<ProductsFetchType>` - Возвращает промис, который будет разрешен с данными типа `ProductsFetchType` после успешного получения всех продуктов.

### OrdersService

Служебный класс адаптер для отправки заказа. В конструктор принимает объект `api` с реализацией интерфейса `Api`.\

Методы:
- `postOrder(order: OrderFetchType)` - принимает объект типа `OrderFetchType` и возвращает промис, который будет разрешен с объектом типа `success` после успешной отправки заказа.


#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   


## Слой данных


### Класс ProductsData
Класс `Products` управляет данными о товарах.
Принимает в конструктор `orderService`.\

Поля:
- `_products: IProduct[]` - Хранит массив товаров.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- `refresh(cb?: (data: IProduct[]) => void): Promise<IProduct[]>` - Обновляет список продуктов, используя `service.getAllProducts()`. Принимает опциональный колбэк `cb`, который будет вызван после обновления списка продуктов с обновленными данными.
Возвращает промис, который будет разрешен с обновленным массивом продуктов.
- `getProducts(): IProduct[]`: Возвращает текущий список продуктов.
- `getProductById(id: string): IProduct | undefined` - Находит продукт в списке по его ID. Возвращает найденный продукт (типа `IProduct`) или `undefined`, если продукт не найден.
- `setProducts(products: IProduct[]): void`: Сохраняет новый список продуктов.

### Класс OrderModel
Класс `OrderModel` управляет данными заказа, хранит список товаров и данные пользователя, дает к ним доступ. 
Принимает в конструктор `orderService`.\

Поля:
- `get productsList(): IProduct[]` - Геттер. Возвращает список продуктов в заказе.
- `set user(user: Partial<UserData>)` - Сеттер. Записывает данные пользователя.

Методы:
- `sendOrder(): Promise<success>` - Возвращает промис, который резолвется с результатом отправки заказа.
- `addProduct(product: IProduct): number` - Добавляет товар в заказ. Возвращает количество продуктов в заказе.
- `removeProduct(id: string): number` - Удаляет товар из заказа. Возвращает количество продуктов в заказе.
- `hasProduct(id: string): boolean` - Проверяет наличие продуктав заказе.
- `clearOrder(): number` - Возвращает количество продуктов взаказе после очистки.


## Слой представления View
Классы представления отвечают за отображение внутри контейнера (DOM-элемента) передаваемых в них данных, а также для формирования отображаемого контента


### Класс ProductCardView

Отвечает за отображение карточки товара задавая в товаре данные названия, изображения, категории, цены, описания.
`ProductCardView` - настройки, которые передаются в конструктор .

```ts
type ProductCardSettings = {
	title: string;
	description: string;
	price: number;
	image: string;
	category: string;
	id: string;
	onClick: (data: IProduct) => void;
};
```

- `title: string` - Название продукта.
- `description: string` - Описание товара
- `image: string` - Путь к изображению продукта.
- `category: string` - Категория продукта.
- `price: number` - Цена продукта.
- `onClick(data: IProduct): void` - Функция, вызываемая при клике на карточку продукта.

Методы:
- `render(container: HTMLElement): void`: Метод, который отображает карточку продукта. Он принимает элемент HTML, в который нужно вставить карточку, в качестве аргумента.

### Класс ProductsGalleryView

Отвечает за отображение списка товаров. В конструктор принимает настройки типа `ProductsGallerySettings`:

```ts
type ProductsGallerySettings = {
	products: IProduct[];
	onProductClick: (id: IProduct) => void;
}
```

- `products: IProduct[]` - Массив объектов `IProduct`, представляющих все продукты, которые нужно отобразить в галерее.
- `onProductClick: (id: IProduct) => void` - Функция, которая вызывается при клике на карточку продукта. Она получает id продукта, по которому был произведен клик.

Методы:
- `render(container: HTMLElement): void` - отображает галерею продуктов. Он принимает элемент HTML, в который нужно вставить галерею, в качестве аргумента

### Класс ModalView

Реализует модальное окно. Устанавливает слушатели для закрытия модального окна на клик в оверлей и кнопку-крестик для закрытия окна.
Конструктор принимает `HTMLElement`, который будет являться контейнером отображения контента и колбэк `onClick: () => void` для управления закрытием модального окна.

Методы:
- `setContent(content: HTMLElement): void` - устанавливает новый контент модального окна.
- `show(): void` - отображает модальное окно.
- `hide(): void` - скрывает модальное окно.
- `clear(): void` - очищает содержимое модального окна. 

### Класс ProductCardPreviewView

Реализует отображение карточки товара для отображения в модальном окне. Конструктор Принимает настройки типа `ProductCardPreviewSettings`:

```ts
type ProductCardPreviewSettings = {
	product: IProduct;
	buttonText: string;
	onClick(product: IProduct): void;
}
```
- `product: IProduct` - товар, который нужно отобразить в карточке.
- `buttonText: string` - Текст, который нужно отобразить на кнопке в карточке товара.
- `onClick(product: IProduct): void` - Функция, которая вызывается при клике на кнопку в карточке товара

Методы:
- `template: HTMLElement` - геттер, который возвращает заполненный шаблон карточки товара

### Класс OrderCartView

Реализует отображение корзины. Конструктор Принимает настройки типа `OrderCartSettings`:
```ts
type OrderCartSettings = {
	products: IProduct[];
	totalPrice: string;
	onSubmit(): void;
	onDelete(id: string): void;
};
```

- `products: IProduct[]` - массив товаров добавленных в корзину.
- `totalPrice: string` - Общая стоимость товаров в корзине.
- `onSubmit: () => void` - Функция, вызываемая при нажатии на кнопку оформления заказа.
- `onDelete(id: string): void` - Функция, вызываемая при удалении товара из корзины.

Методы:
- `template: HTMLElement` - геттер, возвращает заполненный шаблон корзины.

### FormDeliveryView

Реализует часть формы для формирвоания заказа. Принимает настройки типа `FormDeliveryViewSettings`.
```ts
type FormDeliveryViewSettings = {
	onChangeForm(form: FormDeliveryView): void;
	onSubmit(data: Partial<UserData>): void;
}
```

- onChangeForm - Вызывается при изменении данных в форме.
- onSubmit - Вызывается при отправке формы.

Поля:
- `template: HTMLElement` - геттер, возвращает заполненный шаблон формы
- `error: HTMLElement` - элемент который отображает ошибки валидации.
- `submitButton: HTMLElement` - элемент отвечающий за отправку формы.

Методы:
- `btnToggle(e: MouseEvent, listBtn: HTMLButtonElement[]): void` - обрабатывает клик по кнопкам выбора типа оплаты.
- `validate(): boolean`: Метод, который выполняет валидацию данных в форме и возвращает `true`, если данные валидны, и `false` в противном случае. Устанавливает сообщение об ошибке и доступность `submitButton`
- `isValid(): boolean`: Метод, который проверяет, заполнены ли все поля в форме.

### FormContactsView

Реализует часть формы для формирвоания заказа. Принимает настройки типа `FormContactsViewSettings`.
```ts
type FormContactsViewSettings = {
	onChangeForm(form: IFormContactsView): void;
	onSubmit(data: Partial<UserData>): void;
};
```

- onChangeForm - Вызывается при изменении данных в форме.
- onSubmit - Вызывается при отправке формы.

Поля:
- `template: HTMLElement` - геттер, возвращает заполненный шаблон формы
- `error: HTMLElement` - элемент который отображает ошибки валидации.
- `submitButton: HTMLElement` - элемент отвечающий за отправку формы.

Методы:
- `validate(): boolean`: Метод, который выполняет валидацию данных в форме и возвращает `true`, если данные валидны, и `false` в противном случае. Устанавливает сообщение об ошибке и доступность `submitButton`
- `isValid(): boolean`: Метод, который проверяет, заполнены ли все поля в форме.

### Класс Success

Реализует окно завершения заказа. Принимает настройки типа `successSettings`.

```ts
type successSettings = {
	res: { id: string; total: number };
	onClick: () => void;
}
```
- `res: { id: string; total: number }` - тип ответа при успешной отправке заказа
-	`onClick: () => void` - функция, вызываемая при нажатии на кнопку подтверждения. 

Поля:
- `template: HTMLElement` - возвращает заполненный шаблоон окна подтверждения


## Слой представления Presenter

Presenter связывает модель и представление, обрабатывая логику приложения. Испольузет `EventEmitter`, который обеспечивает механизм подписки и уведомления компонентов о событиях.


### Класс AppPresenter

Реализует взаимодействие всех частей проекта. Инициализирует приложение, создает презентеры для частей приложения и связывает их. Инициирует получение данных с сервера для дальнейшей работы.

- `updateCartCount(data: { count: string }): void` - Метод, который обновляет количество товаров в корзине, отображаемое в хедере страницы. Он принимает объект с количеством товаров в качестве аргумента.
- `changeLocked(): void` - Метод, который блокирует или разблокирует прокрутку страницы. 

### Класс ProductsPresenter

Обрабатывает взаимодействие `ProductModel` и отображений `Product`. В конструктор принимает инстансы `ProductModel` и `EventEmitter`.

Методы:
- `refreshProducts(): void` - обновляет данные о товарах.
- `createGallery(products: IProduct[]): void` - обновление отображения товаров на главной странице
- `openProduct(product: IProduct): void` - инициирует показ карточки в модальном окне

### Класс ModalPresenter

Обрабатывает взаимодействия частей приложения с модальным окном.

Поля:
- `modal: ModalView` - экземпляр класса ModalView, который отвечает за отображение модального окна

Методы:
- `addListeners(): void` - предназначен для регистрации слушателей на события, связанные с модальным окном. Он создает обработчики для различных действий, таких как создание карточки продукта, показ корзины, обработка форм и отображение сообщений об успешных операциях.

### Класс OrderPresenter

Обрабатывает взаимодействия частей приложения с моделью `orderModel`.
При создании создает обработчики различных действий, таких как добавление, удаление товара в заказа, изменение данных пользователя, полученных из форм.
Принимает в конструктор инстансы `EventEmitter` и `OrderModel`.

### Класс FormPresenter

Поля: 
-	`address: string` - содержимое поля address
-	`email: string` - содержимое поля email
-	`payment: PaymentType` - содержимое поля payment
-	`phone: string` - содержимое поля phone

Методы:
- `addListeners(): void` - предназначен для регистрации слушателей на события, связанные с формой заказа. Он создает обработчики для различных действий, таких как изменение в полях ввода, сохранение данных, отправка данных форм.


### Реализация процессов в приложении


Процессы в приложении реализованы с помощью событий, которые позволяют различным компонентам взаимодействовать друг с другом без жесткой связки. Это достигается с помощью класса EventEmitter, который позволяет подписываться на события и уведомлять слушателей о произошедших изменениях.

*Список всех событий, которые могут генерироваться в системе:*\

*События главной страницы*
- `app.updateProductsCount` - обновление количества товаров в корзине

*События связанные с моделью данных товаров*
- `product.ready` - окончание загрузки товаров

*События модального окна*
- `modal.showModal` - открытие модалки
- `modal.hideModal` - закрытие модалки
- `modal.createCart` - создание контента для корзины
- `modal.createProduct` - создание контента для превью товара
- `modal.createFormDelivery` - создание контента для формы доставки
- `modal.createFormContacts` - создание контента для формы контактов
- `modal.createSuccess` - создание контента для окна подтверждения

*События связанные с оформлением заказа*
- `order.send` - отправка заказа на сервер
- `order.success` - успешное размещение заказа на сервере
- `order.setUser` - сохранение данных в модель данных
- `order.remove` - удаление товара из заказа
- `order.add` - добавление товара в заказ

*События формы*
- `form.change` - изменения в полях ввода
- `form.updateData` - обновление данных полученных из полей ввода
- `form.submit`- отправка формы
