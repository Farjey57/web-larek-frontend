# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

*Изменения в верстке* 
- `<template id="basket">` убран аттрибут disabled у `.basket__button`
- `<template id="card-catalog">` - убран дефолтный класс цвета категории, дефолт установлен в utils для рендера товаров

## Данные и типы данных, используемые в приложении

IProduct (Интерфейс):
   
```ts
type IProduct = {
  id: number;        // Уникальный идентификатор товара
  description: string;      // Описание товара
  image: string;     // URL изображения товара
  title: string;     // Название товара
  category: string;  // Категория товара
  price: number;     // Цена товара
}
```

UserData (данные вводимые пользователем):

```ts
type UserData = {
  phone: string;
	email: string;
	address: string;
	payment: PaymentType;
}
```

enum для поля payment
```ts
enum PaymentType {
	card = 'card',
	cash = 'cash',
}
```

## Архтектура приложения

Архитектура проекта основана на паттерне MVP (Model-View-Presenter):
- модель - реализована классами `OrderModel` и `ProductModel`. Управляет данными приложения, включая товары и корзину;
- отображение - отображает данные пользователю и обрабатывает пользовательский ввод;
- презентер - отвечает за связь представления и данных, обрабатывает события с помощью `eventEmiter`. Презентер расположен в файле index.ts

## Базовый код ( не относится к слоям)

### ProductsService

Служебный класс адаптер для получения данных о товарах. В конструктор принимает объект `api` с реализацией интерфейса `Api`  и адрес для получения изображений `cdn`.\

Методы:
- `getAllProducts(): Promise<IProduct[]>` - Возвращает промис, который будет разрешен с данными типа `IProduct[]` после успешного получения и обработки всех продуктов.

### OrdersService

Служебный класс адаптер для отправки заказа. В конструктор принимает объект `api` с реализацией интерфейса `Api`.\

Методы:
- `postOrder(order: OrderFetchType)` - принимает объект типа `OrderFetchType` и возвращает промис, который будет разрешен с объектом типа `OrderResultType` после успешной отправки заказа.


#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   


## Слой данных


### Класс ProductsData
Класс `Products` управляет данными о товарах.\

Поля:
- `_products: IProduct[]` - Хранит массив товаров.

Методы:
- `getProducts(): IProduct[]`: Возвращает текущий список продуктов.
- `getProductById(id: string): IProduct | undefined` - Находит продукт в списке по его ID. Возвращает найденный продукт (типа `IProduct`) или `undefined`, если продукт не найден.
- `setProducts(products: IProduct[]): void`: Сохраняет новый список продуктов.

### Класс OrdersModel
Класс `OrdersModel` управляет данными заказа, хранит список товаров и данные пользователя, дает к ним доступ./

Поля:
- `productsList: IProduct[]` - Геттер. Возвращает список продуктов в заказе.
- `user: Partial<UserData>` - Сеттер. Записывает данные пользователя.
- `dataOrder: OrderFetchType` - возвращает данные заказа для отправки на сервер
- `count: number` - количество товаров в корзине
- `total: number` - возвращает сумму товаров в корзине

Методы:
- `addProduct(product: IProduct)` - Добавляет товар в заказ.
- `removeProduct(id: string)` - Удаляет товар из заказа. 
- `hasProduct(id: string): boolean` - Проверяет наличие продуктав заказе.
- `clearOrder(): void` - Очищает все поля заказа
- `validateDelivery(cb?: (errors: Partial<OrderFetchType>) => void): boolean` - валидация данных FormDelivery
- `validateContacts(cb?: (errors: Partial<OrderFetchType>) => void): boolean` - валидация данных FormContacts


## Слой представления View
Классы представления отвечают за отображение внутри контейнера (DOM-элемента) передаваемых в них данных, а также для формирования отображаемого контента


### Класс Card

Абстрактный класс `Card` описывающий карточку товара. Принимает в конструктор id темплейта и настройки. В зависимости от отображения, класс расширяет интерфейс и настройки.

Методы:
- `render(): HTMLElement` - возвращает заполненный темплейт карточки товара

### Класс CardGalleryView

Дочерний класс `Card`. Отвечает за отображение карточки товара в галерее задавая в товаре данные названия, изображения, категории, цены, описания.
`ICardGallerySettings` - настройки, которые передаются в конструктор .

```ts
interface ICardGallerySettings extends ICardSettings {
	onClick: (product: IProduct) => void;
}
```

- `product: IProduct` - данные о товаре
- `onClick(product: IProduct): void` - Функция, вызываемая при клике на карточку продукта.

Методы:
- `render(): void`: отображение карточки товара

### Класс CardPreviewView

Дочерний класс `Card`. Реализует отображение карточки товара для отображения в модальном окне. Конструктор Принимает настройки типа `ProductCardPreviewSettings`:

```ts
interface ICardPreviewSettings extends ICardSettings {
	state: boolean;
	onClick: (preview: CardPreviewView) => void;
}
```

- `state: boolean` - управляет состоянием кнопки, возможности купить
- `onClick(preview: CardPreviewView): void` - Функция, которая вызывается при клике на кнопку в карточке товара

Методы:
- `state: boolean` - сеттер, устанавливает стейт кнопки
- `render(): HTMLElement` - отображает превью карточку товара

### Класс CardCartView

Дочерний класс `Card`. Реализует отображение карточки в корзине. Конструктор принимает настройки типа `ProductCardCartSettings`:

```ts
type CardCartSettings = {
	index: number;
	onDelete: (id: string) => void;
};
```


### Класс ModalView

Реализует модальное окно. Устанавливает слушатели для закрытия модального окна на клик в оверлей и кнопку-крестик для закрытия окна.
Конструктор принимает `HTMLElement`, который будет являться контейнером отображения контента и колбэк `onClick: () => void` для управления закрытием модального окна.

Методы:
- `setContent(content: HTMLElement): void` - устанавливает новый контент модального окна.
- `show(): void` - отображает модальное окно.
- `hide(): void` - скрывает модальное окно.
- `clear(): void` - очищает содержимое модального окна. 

### Класс CartView

Реализует отображение корзины. Конструктор Принимает настройки типа `OrderCartSettings`:
```ts
type CartSettings = {
  products: IProduct[];
	totalPrice: number;
	onSubmit(): void;
};
```

- `products: IProduct[]` - массив товаров добавленных в корзину.
- `totalPrice: string` - Общая стоимость товаров в корзине.
- `onSubmit: () => void` - Функция, вызываемая при нажатии на кнопку оформления заказа.

Интерфейс:
Поля:
- `totalPrice: number` - сеттер, устанавливает общую стоимость товаров
- `listContainer: HTMLElement[]` - сеттер, обновляет содержимое корзины

Методы:
- `render(): HTMLElement` - отображает корзину с её содержимым

### Form

Базовый класс для форм. Реализуется интерфейсом `IFormState`. Конструктор принимает id темплейта и настройки типа `IFormSettings<T>`. В базовом классе инициализируются все необходимые элементы темплейта, устанавливаются слушатели.

```ts
export interface IFormSettings<T> {
	onChangeForm(field: keyof T, value: string): void; // Колбэк для уведомления об изменениях в инпутах
	onSubmit(formName: string): void; // Колбэк для отправки формы, инициирует событие
}
```

Поля:
- `valid: boolean` - сеттер, устанавливает состояние кнопки отправки
-	`errors: string` - сеттер, устанавливает ошибки, пришедшие после валидации
Методы:
- `render(state: IFormState): HTMLFormElement` - возвращает форму с заданным начальным состоянием полей (state)

### FormOrderView

Реализует форму для ввода данных об оплате и адресе для формирования заказа. Является дочерним классом `Form`.

Поля:
- `address: string` - сеттер, устаналвивает значение поля `address`.
- `payment: HTMLButtonElement | null` - сеттер, устанавливает выбраный сопсоб оплаты `payment`.

### FormContactsView

Реализует форму для ввода номера телефона и email для формирования заказа. Является дочерним классом `Form`.

Поля:
- `phone: string` - сеттер, устаналвивает значение поля `phone`.
- `email: string` - сеттер, устаналвивает значение поля `email`.

### Класс Success

Реализует окно завершения заказа. Принимает настройки типа `successSettings`.

```ts
type successSettings = {
	res?: { id: string; total: number }; 
	onClick: () => void; 
}
```
- `res: { id: string; total: number }` - тип ответа при успешной отправке заказа
-	`onClick: () => void` - функция, вызываемая при нажатии на кнопку подтверждения. 

Поля:
- `description: string` - устанавливает текстовое содержимое окна
Методы:
- `render` - возвращает заполненный шаблон окна подтверждения


## Слой представления Presenter

Presenter связывает модель и представление, обрабатывая логику приложения. Испольузет `EventEmitter`, который обеспечивает механизм подписки и уведомления компонентов о событиях.


### Реализация процессов в приложении


Процессы в приложении реализованы с помощью событий, которые позволяют различным компонентам взаимодействовать друг с другом без жесткой связки. Это достигается с помощью класса `EventEmitter`, который позволяет подписываться на события и уведомлять слушателей о произошедших изменениях.

*Список всех событий, которые могут генерироваться в системе:*\

*События главной страницы*
- `page.updateProductsCount` - обновление количества товаров в корзине

*События связанные с моделью данных товаров*
- `product.ready` - окончание загрузки товаров

*События модального окна*
- `modal.showModal` - открытие модалки
- `modal.hideModal` - закрытие модалки
- `modal.openCart` - открытие корзины
- `modal.createProduct` - создание контента для превью товара
- `modal.createFormDelivery` - создание контента для формы доставки
- `modal.createPreview` - отображение превью товара
- `modal.createFormContacts` - создание контента для формы контактов

*События связанные с оформлением заказа*
- `order.remove` - удаление товара из заказа
- `order.add` - добавление товара в заказ
- `order.update` - корзина обновилась
- `order.send` - отправка заказа на сервер
- `order.success` - успешное размещение заказа на сервере

*События формы*
- `orderForm.submit` - события сабмита для формы ввода адреса и способа оплаты. 
- `contactsForm.submit` - события сабмита для формы ввода телефона и email
- `/^order\..*\.change/` - изменение в полях формы order
- `/^contacts\..*.change/` - изменение в полях формы contacts
- `formOrderErrors.change` - изменение состояния валидации формы Order
- `formContactsErrors.change` - изменение состояния валидации формы Contacts
